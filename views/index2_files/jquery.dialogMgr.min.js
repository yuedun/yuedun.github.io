!function(h){function m(){return top.CKEDITOR&&top.CKEDITOR.zindex?(top.CKEDITOR.zindex<h.Dialog.__zindex&&(top.CKEDITOR.zindex=h.Dialog.__zindex),++top.CKEDITOR.zindex):++h.Dialog.__zindex}h.browser={},h.browser.mozilla=/firefox/.test(navigator.userAgent.toLowerCase()),h.browser.webkit=/webkit/.test(navigator.userAgent.toLowerCase()),h.browser.opera=/opera/.test(navigator.userAgent.toLowerCase()),h.browser.msie=/msie/.test(navigator.userAgent.toLowerCase()),h.Dialog=function(n){var t=this;(n=h.extend({showTitle:!0,draggable:!0,modal:!0,center:!0,fixed:!0,time:0,id:!1,left:0,top:0},n)).id=n.id?n.id:"euiDialogContainer-"+h.Dialog.__count;var o=n.id+"-overlay",r=null,i=!1,s=h.browser.msie,a=h.browser.msie&&"6.0"==h.browser.version,l=0;this.id=n.id;var c=n.scope||h("body"),u=document.documentElement.clientWidth||window.screen.width,d=document.documentElement.clientHeight||window.screen.height;h.Dialog.__zindex=n.zindex||h.Dialog.__zindex;var f=h('<div id="'+n.id+'" class="euiDialogContainer"></div>').css({position:"absolute",left:"-10000px",top:"-10000px"});this.instanceDialog=f,c.append(f),this.resetPos=function(){if(n.left||n.top)f.css({left:n.left,top:n.top});else if(n.center){var e=(u-f.width())/2,t=(d-f.height())/2;d<f.height()&&(t=5),u<f.width()&&(e=5),!a&&n.fixed?f.css({top:t,left:e}):f.css({top:t+h(document).scrollTop(),left:e+h(document).scrollLeft()})}},this.init=function(e){if(n.modal&&!e&&(c.append('<div id="'+o+'" class="euiDialogContainer-overlay">'+(a?"<iframe  class='iframe-for-select'></iframe>":"")+"</div>"),h("#"+o).css({left:0,top:0,width:"100%",height:h(window.parent.document).height(),"z-index":m(),position:"fixed",background:"none repeat scroll 0 0 #000",opacity:.5}).hide()),f.css({"z-index":m(),position:n.fixed?"fixed":"absolute",width:n.width?n.width:"auto",height:n.height?n.height:"auto"}),h(window).resize(function(){h("#"+o).css({height:h(window.parent.document).height(),width:h(window.parent.document).width()})}),a&&n.fixed){f.css("position","absolute"),this.resetPos();parseInt(f.css("top")),h(document).scrollTop(),parseInt(f.css("left")),h(document).scrollLeft();h("#"+o).css({height:d,width:u}).children("iframe").css({height:d,width:u})}var s={x:0,y:0};function i(e){var t=window.event||e,i=parseInt(f.css("top"))+(t.clientY-s.y),n=parseInt(f.css("left"))+(t.clientX-s.x),o=f.width(),r=f.height();(i<0||d<i+r)&&(i=f.css("top")),(n<0||u<n+o)&&(n=f.css("left")),f.css({top:i,left:n}),s.x=t.clientX,s.y=t.clientY,c.css("cursor","move").noSelect()}f.find(".js_move").mousedown(function(e){if(n.draggable){var t=window.event||e;s.x=t.clientX,s.y=t.clientY,h(document).bind("mousemove",i)}}),h(document).mouseup(function(e){h(document).unbind("mousemove",i),c.css("cursor","default").noSelect(!1)}),0!=n.time&&(r=setTimeout(this.close,n.time)),f.find(".js_close").click(function(){n.closeFun&&n.closeFun()||t.close()}),f.find(".js_confirm").click(function(){n.confirmFun&&n.confirmFun()||t.close()}),f.find(".js_cancel").click(function(){n.cancelFun&&n.cancelFun()||t.close()})},this.setContent=function(e){var n=f;if("object"==typeof e)switch(e.type.toLowerCase()){case"id":n.html(h("#"+e.value).html());break;case"img":n.html("加载中..."),h('<img alt="" />').load(function(){n.empty().append(h(this)),this.resetPos()}).attr("src",e.value);break;case"url":n.html("加载中..."),h.ajax({url:e.value,success:function(e){n.html(e),this.resetPos()},error:function(e,t,i){n.html("出错啦")}});break;case"iframe":n.append(h('<iframe src="'+e.value+'" />'));break;case"text":default:n.html(e.value)}else n.html(e)},this.toggle=function(){h("#"+o).css("z-index",m()),f.css("z-index",m())},this.show=function(e){i&&!e||(null!=n.beforeShow&&n.beforeShow(),n.modal&&(l=l||function(e){if(!s)return h("#"+e).css("opacity");if(h.support.opacity)return h("#"+e).css("opacity");var t=document.getElementById(e);return null!=t&&null!=t.filters&&null!=t.filters.alpha&&null!=t.filters.alpha.opacity?t.filters.alpha.opacity/100:1}(o),h("#"+o).fadeTo(300,l)),f.show(),null!=n.afterShow&&n.afterShow(),i=!0,0!=n.time&&(r=setTimeout(this.close,n.time)),this.resetPos())},this.hide=function(){i&&(null!=n.beforeHide&&n.beforeHide(),f.hide(),null!=n.afterHide&&n.afterHide(),n.modal&&h("#"+o).fadeOut(300),i=!1)},this.close=function(){n.beforeClose&&n.beforeClose(),f.remove(),i=!1,null!=n.afterClose&&n.afterClose(),n.modal&&h("#"+o).fadeOut(300,function(){h(this).remove()}),clearTimeout(r)},h.Dialog.__count++},h.Dialog.__zindex=500,h.Dialog.__count=1,h.fn.noSelect=function(e){return null==e||e?this.each(function(){h.browser.msie||h.browser.safari?h(this).bind("selectstart",function(){return!1}):h.browser.mozilla?(h(this).css("MozUserSelect","none"),h("body").trigger("focus")):h.browser.opera?h(this).bind("mousedown",function(){return!1}):h(this).attr("unselectable","on")}):this.each(function(){h.browser.msie||h.browser.safari?h(this).unbind("selectstart"):h.browser.mozilla?h(this).css("MozUserSelect","inherit"):h.browser.opera?h(this).unbind("mousedown"):h(this).removeAttr("unselectable","on")})},h.dialogMgr=function(){var i,n=[],o={},r=h.Dialog,s={modal:!0,closable:!1,async:!1};return getDialogs=function(){return n},create=function(t){if((o=h.extend(o,s,t)).url){var e=(new Date).getTime();return-1==o.url.indexOf("?")?o.url+="?nowT="+e:o.url+="&nowT="+e,h.ajax({async:o.async,url:o.url,data:o.param,dataType:o.dataType||"html",type:o.type||"get",contentType:o.contentType||"application/x-www-form-urlencoded",success:function(e){return disableScroll("ifm"),o=h.extend(o,{html:e}),(i=new r(t)).EUI_PARAM=t,n.push(i),i.setContent(e),i.init(),i.show(),null!=o.loadOverCall&&"function"==typeof o.loadOverCall&&o.loadOverCall(),o={},i},error:function(e){alert(e)}}),i}return disableScroll("ifm"),(i=new r(t)).EUI_PARAM=t,n.push(i),i.setContent(t.html),i.init(),i.show(),o={},i},this.disableScroll=function(e){},this.inableScroll=function(e){},hide=function(e){var t=_findIndexOf(e);return-1!==t?n[t].hide():getActiveDialog().hide(),t},show=function(e){var t=_findIndexOf(e);return-1!==t&&n[t].show(),t},toggle=function(e){var t=_findIndexOf(e);t=-1==t?n.length-2:t,n[t].toggle();var i=n.splice(t,1);n.push(i[0])},refresh=function(e){var t=getActiveDialog();if((o=h.extend(!0,o,s,t.EUI_PARAM,e||{})).url){var i=(new Date).getTime();return-1==o.url.indexOf("?")?o.url+="?nowT="+i:o.url+="&nowT="+i,void h.ajax({async:o.async,url:o.url,data:o.param,success:function(e){return t.setContent(e),t.init(!0),t.show(!0),o={},t},error:function(e){alert(e)}})}return t.setContent(e.html),t.init(!0),t.show(!0),o={},t},remove=function(e,t){var i=_findIndexOf(e);return-1!==i?_destoryInstance(n.splice(i,1)[0]):t||_destoryInstance(n.pop()),inableScroll("ifm"),i},getActiveDialog=function(){return n[n.length-1]},getParamByDialogId=function(e){var t=_findIndexOf(e);return-1!==t?n[t].EUI_PARAM:t},getActiveParam=function(){return getActiveDialog().EUI_PARAM},_destoryInstance=function(e){e&&e.close()},_findIndexOf=function(e){for(var t=0;t<n.length;t++)if(n[t].id===e)return t;return-1},{create:create,hide:hide,show:show,toggle:toggle,refresh:refresh,remove:remove,getActiveDialog:getActiveDialog,getParamByDialogId:getParamByDialogId,getActiveParam:getActiveParam,getDialogs:getDialogs}}()}(jQuery);